<!doctype html>
<html>
<head>
    <title>RentMeLtd.</title>
    <link rel="stylesheet" href="./style/bootstrap/css/bootstrap.min.css">
</head>
<body>

<button type="submit" onclick="test()">Test</button>
<p id="test"></p>
<div class="container">
    <form action="#">
        <label>Get all cars</label>
        <input class="btn" type="submit" onclick="showCars()" value="Get'em all"/>
    </form>
    <div>
        <table class="table" id="cars">

        </table>
    </div>
</div>
<div class="container">
    <form action="#">
        <label>Get all customers</label>
        <input class="btn" type="submit" onclick="showCustomers()" value="Get'em all"/>
    </form>
    <div>
        <table class="table" id="customers">

        </table>
    </div>
</div>
</body>
<!-- Modal -->
<div class="modal fade" id="modal-history" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script src="./style/bootstrap/js/bootstrap.min.js"></script>

<script>
    function test() {
        document.getElementById("test").innerHTML = httpGet("/api/customers");
    }

    function httpGet(url) {
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", url, false);
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    function showCustomers() {
        let result = JSON.parse(httpGet("/api/customers"));
        let table = document.getElementById("customers");
        table.innerHTML = "";
        let header = getHeader("customers");
        table.append(header);

        for (let i = 0; i < result.length; i++) {
            let customer = result[i];
            let customerElement = document.createElement('tr');
            let vorname = document.createElement('td');
            vorname.innerHTML = customer.first_name;
            let nachname = document.createElement('td');
            nachname.innerHTML = customer.last_name;
            let tdHistoryButton = document.createElement('td');
            let historyButton = document.createElement('button');
            historyButton.innerHTML = "show history";
            historyButton.classList = "btn btn-info";
            historyButton.setAttribute("data-id", customer.first_name + "," + customer.last_name);
            historyButton.addEventListener("click", showHistory)
            tdHistoryButton.append(historyButton);

            customerElement.append(vorname);
            customerElement.append(nachname);
            customerElement.append(tdHistoryButton);

            table.append(customerElement);
        }
    }

    function showHistory() {
        console.log(this.getAttribute("data-id"));
    }

    function showCars() {
        let result = JSON.parse(httpGet("/api/cars"));
        let table = document.getElementById("cars");
        table.innerHTML = "";
        let header = getHeader("cars");
        table.append(header);

        for (let i = 0; i < result.length; i++) {
            let car = result[i];
            let carElement = document.createElement('tr');
            let name = document.createElement('td');
            name.innerHTML = car.name;
            let brand = document.createElement('td');
            brand.innerHTML = car.brand;
            let color = document.createElement('td');
            color.innerHTML = car.color;
            let booked = document.createElement('td');
            booked.innerHTML = car.is_booked;
            let seats = document.createElement('td');
            seats.innerHTML = car.number_of_seats;
            carElement.append(name);
            carElement.append(brand);
            carElement.append(color);
            carElement.append(booked);
            carElement.append(seats);

            table.append(carElement);
        }
    }

    function getHeader(kind) {
        let header = document.createElement("tr");
        switch (kind) {
            case "cars":
                let nameHeader = document.createElement("th");
                nameHeader.innerHTML = "Name";
                let brandHeader = document.createElement("th");
                brandHeader.innerHTML = "Marke";
                let colorHeader = document.createElement("th");
                colorHeader.innerHTML = "Farbe";
                let bookedHeader = document.createElement("th");
                bookedHeader.innerHTML = "Gebucht";
                let seatsHeader = document.createElement("th");
                seatsHeader.innerHTML = "Anzahl Sitze";
                header.append(nameHeader);
                header.append(brandHeader);
                header.append(colorHeader);
                header.append(bookedHeader);
                header.append(seatsHeader);
                break;
            case "customers":
                let firstNameHeader = document.createElement("th");
                firstNameHeader.innerHTML = "Vorname";
                let lastNameHeader = document.createElement("th");
                lastNameHeader.innerHTML = "Nachname";
                let historyHeader = document.createElement("th");
                historyHeader.innerHTML = "Buchungshistorie";
                header.append(firstNameHeader);
                header.append(lastNameHeader);
                header.append(historyHeader);
        }
        return header;
    }
</script>
</html>
